<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Audio System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .test-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            color: #333;
        }

        button {
            padding: 12px 24px;
            margin: 8px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #FF9F43, #FF6B6B);
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .status {
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        h2 {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        input {
            padding: 10px;
            margin: 5px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            width: 300px;
        }

        .emoji {
            font-size: 3rem;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <h1>üîä Test H·ªá Th·ªëng √Çm Thanh</h1>
    <div class="emoji">üêù</div>

    <div class="test-box">
        <h2>1Ô∏è‚É£ Test TTS Server</h2>
        <p>Ki·ªÉm tra xem TTS server c√≥ ƒëang ch·∫°y kh√¥ng</p>
        <button onclick="testTTSServer()">üéµ Test TTS Server</button>
        <div id="ttsServerStatus"></div>
    </div>

    <div class="test-box">
        <h2>2Ô∏è‚É£ Test Web Speech API</h2>
        <p>Ki·ªÉm tra Web Speech API c·ªßa tr√¨nh duy·ªát</p>
        <button onclick="testWebSpeech()">üó£Ô∏è Test Web Speech</button>
        <button onclick="listVoices()">üìã List Voices</button>
        <div id="webSpeechStatus"></div>
    </div>

    <div class="test-box">
        <h2>3Ô∏è‚É£ Test Custom Text</h2>
        <p>Nh·∫≠p text ƒë·ªÉ test ph√°t √¢m</p>
        <input type="text" id="customText" placeholder="Nh·∫≠p text ti·∫øng Vi·ªát..." value="Xin ch√†o b√© y√™u">
        <br>
        <button onclick="testCustomTTS()">üé§ TTS Server</button>
        <button onclick="testCustomWebSpeech()">üó£Ô∏è Web Speech</button>
        <div id="customStatus"></div>
    </div>

    <div class="test-box">
        <h2>4Ô∏è‚É£ Test Audio Manager</h2>
        <p>Ki·ªÉm tra Audio Manager (cho mobile)</p>
        <button onclick="testAudioManager()">üì± Test Audio Manager</button>
        <div id="audioManagerStatus"></div>
    </div>

    <div class="test-box">
        <h2>5Ô∏è‚É£ System Info</h2>
        <button onclick="showSystemInfo()">‚ÑπÔ∏è Show System Info</button>
        <div id="systemInfo"></div>
    </div>

    <script>
        function showStatus(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Test 1: TTS Server
        function testTTSServer() {
            showStatus('ttsServerStatus', '‚è≥ ƒêang ki·ªÉm tra TTS Server...', 'info');

            const testUrl = '/api/tts?text=xin ch√†o';
            const audio = new Audio(testUrl);

            audio.addEventListener('canplaythrough', function () {
                showStatus('ttsServerStatus', '‚úÖ TTS Server ho·∫°t ƒë·ªông t·ªët!<br>URL: ' + testUrl, 'success');
                audio.play().catch(e => {
                    showStatus('ttsServerStatus', '‚ö†Ô∏è TTS Server OK nh∆∞ng kh√¥ng th·ªÉ play: ' + e.message, 'warning');
                });
            });

            audio.addEventListener('error', function (e) {
                showStatus('ttsServerStatus',
                    '‚ùå TTS Server kh√¥ng kh·∫£ d·ª•ng!<br>' +
                    'L·ªói: ' + (audio.error ? audio.error.message : 'Unknown') + '<br>' +
                    'üí° ƒê·∫£m b·∫£o ƒëang ch·∫°y: <code>node server.js</code><br>' +
                    'üí° M·ªü t·ª´: <code>http://localhost:3001</code>',
                    'error'
                );
            });
        }

        // Test 2: Web Speech API
        function testWebSpeech() {
            if (!window.speechSynthesis) {
                showStatus('webSpeechStatus', '‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Web Speech API', 'error');
                return;
            }

            showStatus('webSpeechStatus', '‚è≥ ƒêang test Web Speech API...', 'info');

            const utterance = new SpeechSynthesisUtterance('Xin ch√†o b√© y√™u');
            utterance.lang = 'vi-VN';
            utterance.rate = 0.9;
            utterance.pitch = 1.1;

            utterance.onstart = function () {
                showStatus('webSpeechStatus', '‚úÖ Web Speech API ho·∫°t ƒë·ªông!<br>ƒêang ph√°t √¢m...', 'success');
            };

            utterance.onend = function () {
                showStatus('webSpeechStatus', '‚úÖ Web Speech API ho·∫°t ƒë·ªông t·ªët!', 'success');
            };

            utterance.onerror = function (e) {
                showStatus('webSpeechStatus', '‚ùå L·ªói Web Speech API: ' + e.error, 'error');
            };

            window.speechSynthesis.speak(utterance);
        }

        // List voices
        function listVoices() {
            if (!window.speechSynthesis) {
                showStatus('webSpeechStatus', '‚ùå Kh√¥ng c√≥ speechSynthesis', 'error');
                return;
            }

            const voices = window.speechSynthesis.getVoices();

            if (voices.length === 0) {
                showStatus('webSpeechStatus', '‚ö†Ô∏è Ch∆∞a load ƒë∆∞·ª£c voices. Th·ª≠ l·∫°i sau 1s...', 'warning');
                setTimeout(listVoices, 1000);
                return;
            }

            const viVoices = voices.filter(v => v.lang.startsWith('vi'));
            const allVoices = voices.map(v =>
                `${v.name} (${v.lang}) ${v.default ? '‚≠ê' : ''}`
            ).join('<br>');

            showStatus('webSpeechStatus',
                `<strong>T·ªïng s·ªë voices: ${voices.length}</strong><br>` +
                `<strong>Vietnamese voices: ${viVoices.length}</strong><br><br>` +
                (viVoices.length > 0 ?
                    '<strong>Vietnamese:</strong><br>' + viVoices.map(v => v.name).join('<br>') + '<br><br>' :
                    '‚ö†Ô∏è Kh√¥ng c√≥ gi·ªçng ti·∫øng Vi·ªát<br><br>'
                ) +
                '<details><summary>All voices</summary>' + allVoices + '</details>',
                'info'
            );
        }

        // Test 3: Custom text
        function testCustomTTS() {
            const text = document.getElementById('customText').value;
            if (!text) {
                showStatus('customStatus', '‚ö†Ô∏è Vui l√≤ng nh·∫≠p text', 'warning');
                return;
            }

            showStatus('customStatus', '‚è≥ ƒêang ph√°t √¢m v·ªõi TTS Server...', 'info');

            const audio = new Audio('/api/tts?text=' + encodeURIComponent(text));

            audio.addEventListener('canplaythrough', function () {
                audio.play().then(() => {
                    showStatus('customStatus', '‚úÖ ƒêang ph√°t √¢m: "' + text + '"', 'success');
                }).catch(e => {
                    showStatus('customStatus', '‚ùå Kh√¥ng th·ªÉ play: ' + e.message, 'error');
                });
            });

            audio.addEventListener('error', function () {
                showStatus('customStatus', '‚ùå TTS Server kh√¥ng kh·∫£ d·ª•ng', 'error');
            });
        }

        function testCustomWebSpeech() {
            const text = document.getElementById('customText').value;
            if (!text) {
                showStatus('customStatus', '‚ö†Ô∏è Vui l√≤ng nh·∫≠p text', 'warning');
                return;
            }

            if (!window.speechSynthesis) {
                showStatus('customStatus', '‚ùå Web Speech API kh√¥ng kh·∫£ d·ª•ng', 'error');
                return;
            }

            showStatus('customStatus', '‚è≥ ƒêang ph√°t √¢m v·ªõi Web Speech...', 'info');

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'vi-VN';
            utterance.rate = 0.9;
            utterance.pitch = 1.1;

            utterance.onend = function () {
                showStatus('customStatus', '‚úÖ ƒê√£ ph√°t √¢m: "' + text + '"', 'success');
            };

            window.speechSynthesis.speak(utterance);
        }

        // Test 4: Audio Manager
        function testAudioManager() {
            if (!window.AudioManager) {
                showStatus('audioManagerStatus', '‚ö†Ô∏è AudioManager ch∆∞a load (ch·ªâ c√≥ trong game)', 'warning');
                return;
            }

            showStatus('audioManagerStatus', '‚úÖ AudioManager ƒë√£ load!', 'success');
        }

        // Test 5: System Info
        function showSystemInfo() {
            const info = {
                'User Agent': navigator.userAgent,
                'Platform': navigator.platform,
                'Language': navigator.language,
                'Online': navigator.onLine,
                'Speech Synthesis': !!window.speechSynthesis,
                'Audio Context': !!(window.AudioContext || window.webkitAudioContext),
                'Current URL': window.location.href,
                'Protocol': window.location.protocol,
                'Host': window.location.host
            };

            const html = Object.keys(info).map(key =>
                `<strong>${key}:</strong> ${info[key]}`
            ).join('<br>');

            showStatus('systemInfo', html, 'info');
        }

        // Auto load voices
        if (window.speechSynthesis) {
            speechSynthesis.onvoiceschanged = function () {
                console.log('Voices loaded:', speechSynthesis.getVoices().length);
            };
        }

        // Welcome message
        window.addEventListener('load', function () {
            console.log('üîä Audio Test Page Loaded');
            console.log('Current URL:', window.location.href);
            console.log('Protocol:', window.location.protocol);

            if (window.location.protocol === 'file:') {
                alert('‚ö†Ô∏è ƒêang m·ªü t·ª´ file://\nTTS Server s·∫Ω kh√¥ng ho·∫°t ƒë·ªông!\n\nVui l√≤ng m·ªü t·ª´: http://localhost:3001/test-audio.html');
            }
        });
    </script>
</body>

</html>