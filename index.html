<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' https://translate.google.com https://*.supabase.co https://api.ipify.org;">
  <title>Học Đọc - Đánh Vần Gamestva</title>
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="Game ghép chữ học đọc tiếng Việt cho bé 3-7 tuổi">

  <!-- Mobile optimizations -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#667eea">
  <meta name="format-detection" content="telephone=no">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🐝</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700;800&family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@400;600;700;800;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=18">
  <link rel="stylesheet" href="responsive-fix.css?v=4">
  <link rel="stylesheet" href="layout-fix.css?v=4">
  <link rel="stylesheet" href="transition-fix.css?v=1">
  <link rel="stylesheet" href="overflow-fix.css?v=1">
  <link rel="stylesheet" href="snow-effect.css?v=1">

  <!-- Legacy styles (fallback) -->
  <link rel="stylesheet" href="styles.css?v=18">
  <link rel="stylesheet" href="responsive-fix.css?v=4">
  <link rel="stylesheet" href="layout-fix.css?v=4">
</head>

<body>
  <!-- LOADING SCREEN -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-content">
      <div class="loading-bee">🐝</div>
      <div class="loading-text">Đang tải...</div>
      <div class="loading-bar">
        <div class="loading-progress"></div>
      </div>
    </div>
  </div>

  <!-- THANH ĐIỀU HƯỚNG CHÍNH -->
  <nav class="main-navbar" id="mainNavbar">
    <div class="nav-brand">
      <span class="nav-logo">🐝</span>
      <span class="nav-title">Gamestva</span>
    </div>

    <div class="nav-menu">
      <button class="nav-item active" data-page="home">
        <span class="nav-icon">🏠</span>
        <span class="nav-text">Trang chủ</span>
      </button>
      <button class="nav-item" data-page="play">
        <span class="nav-icon">🎮</span>
        <span class="nav-text">Chơi game</span>
      </button>
      <button class="nav-item" data-page="shop">
        <span class="nav-icon">🏪</span>
        <span class="nav-text">Cửa hàng</span>
      </button>
      <button class="nav-item" data-page="profile">
        <span class="nav-icon">📖</span>
        <span class="nav-text">Sổ bé giỏi</span>
      </button>
      <button class="nav-item" data-page="parent">
        <span class="nav-icon">👨‍👩‍👧</span>
        <span class="nav-text">Phụ huynh</span>
      </button>
    </div>

    <div class="nav-user">
      <button class="audio-unlock-btn" id="audioUnlockBtn" title="Bật âm thanh">
        🔇
      </button>
      <span class="user-coins">🪙 <span id="navCoins">0</span></span>
      <span class="user-stars">⭐ <span id="navStars">0</span></span>
      <span class="user-avatar" id="navAvatar">🐝</span>
    </div>
  </nav>

  <!-- CONTAINER CHÍNH -->
  <main class="main-content">

    <!-- TRANG CHỦ -->
    <section class="page page-home active" id="pageHome">
      <div class="home-hero">
        <div class="hero-mascot">🐝</div>
        <h1 class="hero-title">Học Đọc - Đánh Vần</h1>
        <p class="hero-subtitle">Cùng bé học ghép chữ tiếng Việt!</p>

        <div class="hero-setup">
          <div class="setup-avatars">
            <p>Chọn hình đại diện:</p>
            <div class="avatar-grid">
              <button class="avatar-btn selected" data-avatar="🐝">🐝</button>
              <button class="avatar-btn" data-avatar="🐰">🐰</button>
              <button class="avatar-btn" data-avatar="🐱">🐱</button>
              <button class="avatar-btn" data-avatar="🦊">🦊</button>
              <button class="avatar-btn" data-avatar="🐻">🐻</button>
              <button class="avatar-btn" data-avatar="🦁">🦁</button>
            </div>
          </div>
          <div class="setup-name">
            <input type="text" id="playerName" placeholder="Tên của bé..." maxlength="20">
          </div>
        </div>

        <button class="btn-play-big" id="btnStartGame">
          <span>🎮</span> Bắt đầu chơi!
        </button>
      </div>

      <!-- Chọn chủ đề -->
      <div class="theme-selection">
        <h2>📚 Chọn chủ đề học</h2>
        <p class="theme-subtitle">Chủ đề hiện tại: <span id="currentThemeName">Động vật</span> <span
            id="currentThemeIcon">🐾</span></p>
        <div class="themes-grid-home" id="themesGridHome">
          <!-- Themes sẽ được tạo bằng JS -->
        </div>
      </div>

      <!-- Chọn cấp độ -->
      <div class="level-selection">
        <h2>Chọn cấp độ</h2>
        <div class="level-grid">
          <div class="level-box level-1" data-level="1">
            <div class="level-badge">�</div>
            <h3>Cấp 1</h3>
            <p>Từ 2-3 chữ</p>
            <span class="level-example">ba, mẹ, cá...</span>
            <div class="level-progress-bar">
              <div class="progress" id="homeProgress1"></div>
            </div>
          </div>
          <div class="level-box level-2" data-level="2">
            <div class="level-badge">�</div>>
            <h3>Cấp 2</h3>
            <p>Từ 4+ chữ</p>
            <span class="level-example">con voi, bầu trời...</span>
            <div class="level-progress-bar">
              <div class="progress" id="homeProgress2"></div>
            </div>
          </div>
          <div class="level-box level-3" data-level="3">
            <div class="level-badge">🌳</div>
            <h3>Cấp 3</h3>
            <p>Câu ngắn</p>
            <span class="level-example">bé ăn cơm...</span>
            <div class="level-progress-bar">
              <div class="progress" id="homeProgress3"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TRANG CHƠI GAME -->
    <section class="page page-play" id="pagePlay">
      <div class="game-area">
        <!-- Thông tin game -->
        <div class="game-info-bar">
          <span class="info-level">Cấp <span id="gameLevel">1</span></span>
          <span class="info-word">Từ <span id="gameWordNum">1</span>/<span id="gameTotalWords">10</span></span>
          <span class="info-stars">⭐ <span id="gameStars">0</span></span>
        </div>

        <!-- Khu vực hình ảnh và từ -->
        <div class="game-display">
          <div class="image-box">
            <div class="word-image" id="wordImage">🐱</div>
            <div class="image-label" id="imageLabel">Con mèo</div>
          </div>

          <div class="instruction-text" id="instructionText">
            Bé hãy ghép chữ nhé! 💪
          </div>
        </div>

        <!-- Ô ghép chữ -->
        <div class="slots-area">
          <div class="word-slots" id="wordSlots">
            <!-- Slots sẽ được tạo bằng JS -->
          </div>
        </div>

        <!-- Chữ cái để kéo -->
        <div class="letters-area">
          <div class="letters-pool" id="lettersPool">
            <!-- Letters sẽ được tạo bằng JS -->
          </div>
        </div>

        <!-- Chuyển chế độ -->
        <div class="mode-switcher">
          <button class="mode-btn active" id="btnModeWord" data-mode="word">
            <span>🔤</span> Ghép chữ
            <button class="mode-btn" id="btnModeSentence" data-mode="sentence">
              <span>📝</span> Ghép câu
        </div>

        <!-- Nút điều khiển -->
        <div class="game-buttons">
          <button class="game-btn btn-hint" id="btnHint">
            <span>💡</span> Gợi ý
          </button>
          <button class="game-btn btn-speak" id="btnSpeak">
            <span>🔊</span> Nghe
          </button>
          <button class="game-btn btn-skip" id="btnSkip">
            <span>⏭️</span> Bỏ qua
          </button>
          <button class="game-btn btn-exit-lesson" id="btnExitLesson" style="display: none;">
            <span>🏠</span> Thoát bài học
          </button>
        </div>
      </div>

      <!-- Popup thành công -->
      <div class="success-popup" id="successPopup">
        <div class="popup-content">
          <div class="popup-stars">⭐⭐⭐</div>
          <h2>Giỏi quá! 🎉</h2>
          <div class="popup-word" id="successWord">MÈO</div>
          <div class="popup-character" id="successCharacter">🐱</div>
          <div class="countdown-timer" id="countdownTimer">
            <span class="countdown-text">Chuyển câu sau</span>
            <span class="countdown-number" id="countdownNumber">4</span>
            <span class="countdown-text">giây</span>
          </div>
        </div>
      </div>

      <!-- Container cho animation nhân vật -->
      <div class="character-animation-container" id="characterAnimationContainer"></div>

      <!-- Confetti -->
      <div class="confetti-container" id="confettiContainer"></div>
    </section>

    <!-- TRANG CỬA HÀNG -->
    <section class="page page-shop" id="pageShop">
      <div class="shop-header">
        <h1 class="shop-title">🏪 Cửa Hàng Đổi Quà</h1>
        <div class="shop-balance">
          <div class="balance-item">
            <span class="balance-icon">🪙</span>
            <span class="balance-label">Xu của bé:</span>
            <span class="balance-value" id="shopCoins">0</span>
          </div>
          <div class="balance-item">
            <span class="balance-icon">⭐</span>
            <span class="balance-label">Sao:</span>
            <span class="balance-value" id="shopStars">0</span>
          </div>
        </div>
        <p class="shop-desc">Làm đúng 1 câu = 1 xu 🪙 | 10 sao = 5 xu 🪙</p>
      </div>

      <div class="shop-categories" id="shopCategories">
        <!-- Categories will be loaded by JS -->
      </div>

      <div class="shop-items-grid" id="shopItemsGrid">
        <!-- Items will be loaded by JS -->
      </div>
    </section>

    <!-- TRANG SỔ BÉ GIỎI -->
    <section class="page page-profile" id="pageProfile">
      <div class="profile-header">
        <div class="profile-avatar-big" id="profileAvatar">🐝</div>
        <h2 id="profileName">Bé</h2>
        <div class="profile-stats-row">
          <div class="stat-box">
            <span class="stat-num" id="statWords">0</span>
            <span class="stat-label">Từ đã học</span>
          </div>
          <div class="stat-box">
            <span class="stat-num" id="statStars">0</span>
            <span class="stat-label">Ngôi sao</span>
          </div>
          <div class="stat-box">
            <span class="stat-num" id="statBadges">0</span>
            <span class="stat-label">Huy hiệu</span>
          </div>
        </div>
      </div>

      <div class="profile-sections">
        <div class="profile-section">
          <h3>🏆 Huy hiệu</h3>
          <div class="badges-row" id="badgesRow"></div>
        </div>

        <div class="profile-section">
          <h3>📚 Từ đã học</h3>
          <div class="learned-words-grid" id="learnedWordsGrid"></div>
        </div>

        <div class="profile-section">
          <h3>🎨 Bộ sưu tập Sticker</h3>
          <div class="stickers-row" id="stickersRow"></div>
        </div>
      </div>
    </section>

    <!-- TRANG PHỤ HUYNH -->
    <section class="page page-parent" id="pageParent">
      <h2 class="parent-title">👨‍👩‍👧 Chế độ Phụ huynh</h2>

      <!-- Tabs -->
      <div class="parent-tabs">
        <button class="parent-tab active" data-tab="stats">📊 Thống kê</button>
        <button class="parent-tab" data-tab="words">📖 Từ đã học</button>
        <button class="parent-tab" data-tab="custom">✏️ Soạn từ</button>
        <button class="parent-tab" data-tab="control">⏰ Giới hạn</button>
        <button class="parent-tab" data-tab="themes">📚 Chủ đề</button>
      </div>

      <!-- Tab: Thống kê -->
      <div class="parent-tab-content active" id="tabStats">
        <div class="parent-stats-grid">
          <div class="parent-stat-card">
            <span class="stat-icon">📖</span>
            <span class="stat-value" id="parentWords">0</span>
            <span class="stat-text">Từ đã học</span>
          </div>
          <div class="parent-stat-card">
            <span class="stat-icon">⏱️</span>
            <span class="stat-value" id="parentTime">0</span>
            <span class="stat-text">Phút chơi</span>
          </div>
          <div class="parent-stat-card">
            <span class="stat-icon">🎯</span>
            <span class="stat-value" id="parentAccuracy">~</span>
            <span class="stat-text">Độ chính xác</span>
          </div>
          <div class="parent-stat-card">
            <span class="stat-icon">🏆</span>
            <span class="stat-value" id="parentMaxLevel">1</span>
            <span class="stat-text">Cấp cao nhất</span>
          </div>
        </div>
      </div>

      <!-- Tab: Từ đã học -->
      <div class="parent-tab-content" id="tabWords">
        <div class="words-learned-header">
          <h3>📖 Danh sách từ đã học</h3>
          <button class="btn-export" id="btnExportWords">📥 Xuất danh sách</button>
        </div>
        <div class="words-learned-list" id="wordsLearnedList">
          <!-- Sẽ được load bằng JS -->
        </div>
      </div>

      <!-- Tab: Soạn từ tùy chỉnh -->
      <div class="parent-tab-content" id="tabCustom">
        <div class="custom-word-form">
          <h3>✏️ Soạn từ/câu mới cho bé</h3>
          <p class="form-desc">Tạo từ vựng hoặc câu riêng phù hợp với bé của bạn</p>

          <div class="form-group">
            <label>Chế độ học:</label>
            <select id="learningModeToggle" class="mode-select">
              <option value="word">🔤 Ghép chữ (từ đơn)</option>
              <option value="sentence">📝 Ghép câu</option>
            </select>
          </div>

          <div class="form-group">
            <label for="customWordInput">Từ cần học:</label>
            <input type="text" id="customWordInput" placeholder="Ví dụ: con mèo" maxlength="50">
          </div>

          <div class="form-group">
            <label>Chọn icon theo danh mục:</label>
            <div class="icon-categories" id="iconCategories">
              <!-- Categories sẽ được load bằng JS -->
            </div>
            <div class="icon-picker" id="iconPicker">
              <!-- Icons sẽ được load bằng JS -->
            </div>
            <div class="selected-icon" id="selectedIcon">🐱</div>
          </div>

          <div class="form-group">
            <label for="customSyllablesInput">Chia âm tiết:</label>
            <input type="text" id="customSyllablesInput" placeholder="Ví dụ: con mèo" maxlength="50">
            <small>Để trống sẽ tự động chia theo khoảng trắng</small>
          </div>

          <button class="btn-add-word" id="btnAddCustomWord">➕ Thêm từ/câu</button>
        </div>

        <div class="custom-words-list">
          <div class="words-header">
            <h3>📝 Từ đã soạn (<span id="customWordCount">0</span>)</h3>
            <button class="btn-create-lesson" id="btnCreateLesson">📚 Tạo bài học</button>
          </div>
          <div id="customWordsList">
            <!-- Custom words sẽ được load bằng JS -->
          </div>
        </div>

        <div class="custom-lessons-list">
          <h3>📚 Bài học tùy chỉnh</h3>
          <p class="lessons-desc">Các bài học được tạo từ từ/câu bạn đã soạn</p>
          <div id="customLessonsList">
            <!-- Custom lessons sẽ được load bằng JS -->
          </div>
        </div>
      </div>

      <!-- Tab: Giới hạn thời gian -->
      <div class="parent-tab-content" id="tabControl">
        <div class="time-control">
          <h3>⏰ Giới hạn thời gian chơi</h3>
          <p class="control-desc">Đặt thời gian chơi mỗi ngày để bảo vệ mắt bé</p>

          <div class="control-toggle">
            <label class="switch">
              <input type="checkbox" id="timeLimitToggle">
              <span class="slider"></span>
            </label>
            <span>Bật giới hạn thời gian</span>
          </div>

          <div class="control-settings" id="timeLimitSettings" style="display: none;">
            <div class="form-group">
              <label>Thời gian chơi mỗi ngày (phút):</label>
              <input type="number" id="timeLimitInput" min="5" max="180" value="30" step="5">
              <div class="time-presets">
                <button class="preset-btn" data-minutes="15">15 phút</button>
                <button class="preset-btn" data-minutes="30">30 phút</button>
                <button class="preset-btn" data-minutes="60">60 phút</button>
                <button class="preset-btn" data-minutes="120">120 phút</button>
              </div>
            </div>

            <div class="time-status">
              <p>⏱️ Thời gian đã chơi hôm nay: <strong id="timePlayedToday">0</strong> phút</p>
              <p>⏳ Thời gian còn lại: <strong id="timeRemaining">30</strong> phút</p>
            </div>

            <button class="btn-save-time" id="btnSaveTimeLimit">💾 Lưu cài đặt</button>
          </div>
        </div>
      </div>

      <!-- Tab: Chọn chủ đề -->
      <div class="parent-tab-content" id="tabThemes">
        <div class="parent-themes">
          <h3>📚 Chọn chủ đề học cho bé</h3>
          <p class="theme-desc">Chọn chủ đề phù hợp với sở thích và độ tuổi của bé</p>
          <div class="themes-grid" id="themesGrid">
            <!-- Themes will be loaded by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="parent-actions">
        <button class="btn-reset" id="btnResetProgress">🔄 Đặt lại tiến độ</button>
      </div>
    </section>
  </main>

  <!-- BÉ ONG MASCOT -->
  <div class="bee-mascot" id="beeMascot">
    <div class="bee-body bee-character">🐝</div>
    <div class="bee-speech" id="beeSpeech">Chào bé yêu! 🌸</div>
  </div>

  <!-- KHO BÁU -->
  <div class="treasure-modal" id="treasureModal">
    <div class="treasure-box">
      <h2>🎁 Kho Báu!</h2>
      <p>Chọn một sticker nhé!</p>
      <div class="treasure-stickers">
        <button class="sticker-pick" data-sticker="🐰">🐰</button>
        <button class="sticker-pick" data-sticker="🐻">🐻</button>
        <button class="sticker-pick" data-sticker="🦖">🦖</button>
        <button class="sticker-pick" data-sticker="🦄">🦄</button>
        <button class="sticker-pick" data-sticker="🐼">🐼</button>
        <button class="sticker-pick" data-sticker="🦋">🦋</button>
      </div>
    </div>
  </div>

  <!-- AUDIO WELCOME MODAL -->
  <div class="audio-welcome-modal" id="audioWelcomeModal">
    <div class="audio-welcome-box">
      <div class="audio-icon">🔊</div>
      <h2>Chào bé yêu! 👋</h2>
      <p>Nhấn nút bên dưới để bật âm thanh và bắt đầu học nhé!</p>
      <button class="btn-enable-audio" id="btnEnableAudio">
        🔊 Bật âm thanh
      </button>
      <button class="btn-skip-audio" id="btnSkipAudio">
        Bỏ qua
      </button>
    </div>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js?v=30"></script>
  <script src="tracking-helper.js?v=1"></script>
  <script src="auto-tracking.js?v=1"></script>

  <script src="mobile-optimizer.js?v=21"></script>
  <script src="audio-manager.js?v=24"></script>
  <script src="snow-effect.js?v=1"></script>
  <script src="word-themes.js?v=21"></script>
  <script src="sentence-data.js?v=20"></script>
  <!-- CELEBRATION OVERLAY - Hiệu ứng chuyển câu -->
  <div class="celebration-overlay" id="celebrationOverlay">
    <div class="celebration-content">
      <div class="celebration-title" id="celebrationTitle">🎉 Giỏi lắm! 🎉</div>
      <div class="celebration-animals" id="celebrationAnimals"></div>
      <div class="celebration-message" id="celebrationMessage">Chuẩn bị câu tiếp theo...</div>
      <div class="celebration-stars">⭐✨⭐✨⭐</div>
      <div class="countdown-timer" id="countdownTimer"></div>
    </div>
  </div>

  <script src="shop-data.js?v=20"></script>
  <script src="parent-controls.js?v=20"></script>
  <script src="parent-page.js?v=20"></script>
  <script src="sound-effects.js?v=20"></script>
  <script src="animal-sounds.js?v=1"></script>
  <script src="animations.js?v=20"></script>
  <script src="main.js?v=32"></script>
</body>

</html>